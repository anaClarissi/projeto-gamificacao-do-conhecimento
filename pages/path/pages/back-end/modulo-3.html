<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Módulo 3 — Servidores e APIs</title>
    
    <!-- Swiper -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@12/swiper-bundle.min.css"/>

    <!-- JQuery -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css"/>

    <!-- Google Fonts Icons -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" />

    <!-- CSS do módulo -->
    <link rel="stylesheet" href="../../css/modulo.css">

</head>

<body>

<header>
    <nav id="nav-bar">
        <span id="nav-logo">
            <img src="" alt="">
            Informática Manhã
        </span>

        <ul id="nav-list">
            <li class="nav-item"><a href="../../../landing/home.html#home">Início</a></li>
            <li class="nav-item active"><a href="../../../landing/home.html#path">Trilhas</a></li>
            <li class="nav-item"><a href="../../../landing/home.html#profession">Profissões</a></li>
            <li class="nav-item"><a href="../../../landing/home.html#quizzes">Quizzes</a></li>
            <li class="nav-item"><a href="../../../landing/home.html#games">Jogos</a></li>
        </ul>

        <button class="btn-default user">
            <i class="fa-solid fa-user"></i>
            <span class="user-name">Área do Aluno</span>
        </button>

        <button id="mobile-btn">
            <i class="fa-solid fa-bars"></i>
        </button>
    </nav>

    <div id="user-menu">
        <ul id="user-nav-list">
            <li class="user-item"><a href="">Conquistas</a></li>
            <li class="user-item"><a href="">Pontos</a></li>
            <li class="user-item"><a href="">Minha Conta</a></li>
            <li class="user-item"><a href="">Sair</a></li>
        </ul>
    </div>

    <div id="mobile-menu">
        <ul id="mobile-nav-list">
            <li class="nav-item"><a href="../../../landing/home.html#home">Início</a></li>
            <li class="nav-item"><a href="../../../landing/home.html#path">Trilhas</a></li>
            <li class="nav-item"><a href="../../../landing/home.html#profession">Profissões</a></li>
            <li class="nav-item"><a href="../../../landing/home.html#quizzes">Quizzes</a></li>
            <li class="nav-item"><a href="../../../landing/home.html#games">Jogos</a></li>
        </ul>
    </div>
</header>

<main class="module-container">

    <div class="module-header">
        <img class="module-image" src="../../../landing/images/path/back-end.svg" alt="">
        <h1 class="section-title">Back-End</h1>
    </div>
    
    <section class="module-type">
        <h1 class="section-subtitle">Módulo 3 — Servidores e APIs</h1>
        <p class="module-description">
            Neste módulo, você vai aprofundar seus conhecimentos em Back-End. Vamos criar servidores robustos, manipular requisições HTTP, trabalhar com rotas e construir APIs REST completas usando Node.js.
        </p>
    </section>

    <section class="module-arrows">
        <a href="modulo-2.html">
            <div class="area-arrows">
                <img src="../../imagens/arrow_back_ios_25dp_46FFA8_FILL0_wght400_GRAD0_opsz24.svg" alt="" class="arrows">
            </div>
        </a>

        <a href="modulo-4.html">
            <div class="area-arrows">
                <img src="../../imagens/arrow_forward_ios_25dp_46FFA8_FILL0_wght400_GRAD0_opsz24.svg" alt="" class="arrows">
            </div>
        </a>
    </section>

    <section class="module-section">
        <h3>1. Servidores HTTP com Node.js</h3>
        <p>
            Servidores recebem requisições de clientes e enviam respostas. Node.js permite criar servidores rapidamente usando o módulo <strong>http</strong>.
        </p>
        <pre class="area-tags"> <p class="pequeno">node.js</p>
<span class="variavel">const</span> http = require('http');

<span class="variavel">const</span> server = <span class="valor">http</span>.<span class="funcao">createServer</span>((req, res) => {
    <span class="valor">res</span>.<span class="funcao">writeHead</span>(200, {'Content-Type': 'text/plain'});
    <span class="valor">res</span>.<span class="funcao">end</span>('Servidor rodando!');
});

<span class="valor">server</span>.<span class="funcao">listen</span>(3000, () => <span class="valor">console</span>.log('Servidor rodando na porta 3000'));
        </pre>
    </section>

    <section class="module-section">
        <h3>2. Rotas e métodos HTTP</h3>
        <p>
            Cada requisição HTTP possui um <strong>método</strong> (GET, POST, PUT, DELETE) e uma <strong>rota</strong> (URL). Isso permite criar APIs REST.
        </p>
        <pre class="area-tags"> <p class="pequeno">node.js</p>
<span class="variavel">const</span> server = http.createServer((req, res) => {
    <span class="variavel">if</span>(<span class="valor">req</span>.<span class="funcao">url</span> === '/usuarios' && <span class="valor">req</span>.<span class="funcao">method</span> === 'GET'){
        <span class="valor">res</span>.<span class="funcao">writeHead</span>(200, {'Content-Type': 'application/json'});
        <span class="valor">res</span>.<span class="funcao">end</span>(JSON.stringify([{nome: 'Ana'}, {nome: 'Pedro'}]));
    } <span class="variavel">else if</span>(<span class="valor">req</span>.<span class="funcao">url</span> === '/usuarios' && <span class="valor">req</span>.<span class="funcao">method</span> === 'POST'){
        <span class="comentario">// código para criar novo usuário</span>
    } <span class="variavel">else</span> {
        <span class="valor">res</span>.<span class="funcao">writeHead</span>(404);
        <span class="valor">res</span>.<span class="funcao">end</span>('Rota não encontrada');
    }
});
        </pre>
    </section>

    <section class="module-section">
        <h3>3. APIs REST</h3>
        <p>
            APIs REST permitem que aplicações troquem dados via HTTP. Boas práticas incluem:
            <ul>
                <li>Rotas intuitivas</li>
                <li>Uso correto de métodos HTTP</li>
                <li>Respostas em JSON</li>
                <li>Status codes corretos</li>
            </ul>
        </p>
        <pre>
GET /usuarios      -> lista todos os usuários
POST /usuarios     -> cria um novo usuário
PUT /usuarios/:id  -> atualiza usuário pelo id
DELETE /usuarios/:id -> deleta usuário pelo id
        </pre>
    </section>

    <section class="module-section">
        <h3>4. Exemplos práticos de API</h3>
        <pre class="area-tags"> <p class="pequeno">node.js</p>
<span class="variavel">const</span> http = <span class="funcao">require</span>('http');
<span class="variavel">let</span> usuarios = [{id: 1, nome: 'Ana'}];

<span class="variavel">const</span> server = <span class="valor">http</span>.<span class="funcao">createServer</span>((req, res) => {
    <span class="variavel">if</span>(<span class="valor">req</span>.<span class="funcao">url</span> === '/usuarios' && <span class="valor">req</span>.<span class="funcao">method</span> === 'GET'){
        <span class="valor">res</span>.<span class="funcao">writeHead</span>(200, {'Content-Type': 'application/json'});
        <span class="valor">res</span>.<span class="funcao">end</span>(JSON.stringify(usuarios));
    } <span class="variavel">else if</span>(<span class="valor">req</span>.<span class="funcao">url</span> === '/usuarios' && <span class="valor">req</span>.<span class="funcao">method</span> === 'POST'){
        <span class="variavel">let</span> body = '';
        <span class="valor">req</span>.<span class="funcao">on</span>('data', chunk => { body += chunk.toString(); });
        <span class="valor">req</span>.<span class="funcao">on</span>('end', () => {
            <span class="variavel">const</span> novoUsuario = <span class="valor">JSON</span>.<span class="funcao">parse</span>(body);
            <span class="valor">usuarios</span>.<span class="funcao">push</span>(novoUsuario);
            <span class="valor">res</span>.<span class="funcao">writeHead</span>(201, {'Content-Type': 'application/json'});
            <span class="valor">res</span>.<span class="funcao">end</span>(JSON.stringify(novoUsuario));
        });
    } <span class="variavel">else</span> {
        <span class="valor">res</span>.<span class="funcao">writeHead</span>(404);
        <span class="valor">res</span>.<span class="funcao">end</span>('Rota não encontrada');
    }
});

<span class="valor">server</span>.<span class="funcao">listen</span>(3000, () => <span class="valor">console</span>.log('API rodando na porta 3000'));
        </pre>
    </section>

    <section class="module-section">
        <h3>5. Exercícios práticos</h3>
        <p>Pratique criando rotas, respondendo requisições e retornando dados JSON corretamente.</p>
    </section>

    <!--QUESTÕES-->
    <section id="coding-questions"></section>

    <section class="module-arrows">
        <a href="modulo-2.html">
            <div class="area-arrows">
                <img src="../../imagens/arrow_back_ios_25dp_46FFA8_FILL0_wght400_GRAD0_opsz24.svg" alt="" class="arrows">
            </div>
        </a>

        <a href="modulo-4.html">
            <div class="area-arrows">
                <img src="../../imagens/arrow_forward_ios_25dp_46FFA8_FILL0_wght400_GRAD0_opsz24.svg" alt="" class="arrows">
            </div>
        </a>
    </section>

</main>

<footer>
    <img src="../../../landing/images/footer/wave.svg" alt="">
    <div id="footer-items">
        <span>&copy 2025 Ana Clarissi</span>
        <div class="social-media-buttons">
            <a href=""><i class="fa-brands fa-whatsapp"></i></a>
            <a href=""><i class="fa-brands fa-instagram"></i></a>
            <a href=""><i class="fa-brands fa-facebook"></i></a>
        </div>
    </div>
</footer>

<script src="../../../landing/js/usuario.js"></script>
<script src="../../../landing/js/script.js"></script>

<script>
    const codingExercises = [
        {
            id: 1,
            title: "Servidor simples",
            description: "Crie um servidor Node.js que exiba 'Olá Mundo API!' na porta 3000.",
            expected: `const http = require('http');
const server = http.createServer((req,res)=>{
    res.writeHead(200,{'Content-Type':'text/plain'});
    res.end('Olá Mundo API!');
});
server.listen(3000);`
        },
        {
            id: 2,
            title: "Rota GET",
            description: "Crie uma rota GET /produtos que retorne um array JSON com dois produtos.",
            expected: `const http = require('http');
const produtos = [{id:1,nome:'Caneta'},{id:2,nome:'Caderno'}];
const server = http.createServer((req,res)=>{
    if(req.url==='/produtos' && req.method==='GET'){
        res.writeHead(200,{'Content-Type':'application/json'});
        res.end(JSON.stringify(produtos));
    }
});
server.listen(3000);`
        },
        {
            id: 3,
            title: "Rota POST",
            description: "Crie uma rota POST /produtos que aceite JSON e adicione ao array de produtos.",
            expected: `const http = require('http');
let produtos = [{id:1,nome:'Caneta'}];
const server = http.createServer((req,res)=>{
    if(req.url==='/produtos' && req.method==='POST'){
        let body='';
        req.on('data',chunk=>{body+=chunk.toString();});
        req.on('end',()=>{
            produtos.push(JSON.parse(body));
            res.writeHead(201,{'Content-Type':'application/json'});
            res.end(JSON.stringify(produtos[produtos.length-1]));
        });
    }
});
server.listen(3000);`
        },
        {
            id: 4,
            title: "Rota DELETE",
            description: "Crie uma rota DELETE /produtos/:id que remova o produto pelo id.",
            expected: `const http = require('http');
let produtos = [{id:1,nome:'Caneta'}];
const server = http.createServer((req,res)=>{
    if(req.url.startsWith('/produtos/') && req.method==='DELETE'){
        const id=parseInt(req.url.split('/')[2]);
        produtos=produtos.filter(p=>p.id!==id);
        res.writeHead(200,{'Content-Type':'application/json'});
        res.end(JSON.stringify(produtos));
    }
});
server.listen(3000);`
        }
    ];

    const renderExercises = () => {
        const container = document.getElementById("coding-questions");
        codingExercises.forEach(ex => {
            container.innerHTML += `
                <div class="exercise-box">
                    <h3>${ex.id}. ${ex.title}</h3>
                    <p>${ex.description}</p>
                    <textarea id="answer-${ex.id}" placeholder="Escreva seu código aqui..."></textarea>
                    <button class="btn-default" onclick="checkAnswer(${ex.id})">Verificar Resposta</button>
                    <div id="result-${ex.id}" class="result"></div>
                </div>
            `;
        });
    }

    const normalizeCode = (code) => {
        if (!code) return "";
        code = code.replace(/\/\*[\s\S]*?\*\//g, "").replace(/\/\/.*$/gm, "");
        code = code.replace(/\r\n/g, "\n").replace(/\n+/g, " ").replace(/\s+/g, " ").trim();
        code = code.replace(/\s*([\=\+\-\*\/%<>!,\:\(\)\{\}\[\]\|&])\s*/g, "$1");
        code = code.replace(/;+/g, "");
        return code;
    }

    const checkAnswer = (id) => {
        const question = codingExercises.find(q => q.id === id);
        const studentRaw = document.getElementById(`answer-${id}`).value || "";
        const studentNormalized = normalizeCode(studentRaw);
        const expectedNormalized = normalizeCode(question.expected);
        const resultBox = document.getElementById(`result-${id}`);
        if (studentNormalized === expectedNormalized) {
            resultBox.innerHTML = "<span class='correct'>✔ Correto!</span>";
        } else {
            resultBox.innerHTML = `
                <span class='wrong'>✘ Resposta incorreta</span>
                <br><strong>Exemplo esperado (formatado):</strong>
                <pre style="white-space:pre-wrap; background:#f7f7f7; padding:8px; border-radius:4px;">${question.expected.replace(/</g, "&lt;")}</pre>
                <details><summary>O que foi enviado (normalizado)</summary><pre style="white-space:pre-wrap;">${studentNormalized.replace(/</g,"&lt;")}</pre></details>
            `;
        }
    }

    renderExercises();
</script>

</body>
</html>
